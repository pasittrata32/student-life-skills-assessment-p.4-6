# คู่มือการเชื่อมต่อฐานข้อมูลกับ Google Sheets

เอกสารนี้จะแนะนำขั้นตอนการสร้างฐานข้อมูลออนไลน์โดยใช้ Google Sheets และ Google Apps Script เพื่อเก็บข้อมูลนักเรียนแยกตามรายชื่อห้องเรียนโดยอัตโนมัติ

---

## 1. การเตรียม Google Sheet

1. ไปที่ [Google Sheets](https://sheets.google.com)
2. สร้างชีตใหม่ (Blank Spreadsheet)
3. ตั้งชื่อไฟล์ตามต้องการ เช่น `Student_Assessment_DB`

## 2. การติดตั้ง Google Apps Script (Back-end)

1. ในหน้า Google Sheet ไปที่เมนู **ส่วนขยาย (Extensions)** > **Apps Script**
2. จะปรากฏหน้าต่างเขียนโค้ด ให้ลบโค้ดเดิม (`function myFunction() {...}`) ออกทั้งหมด
3. คัดลอกโค้ดจากไฟล์ `google_apps_script.js` ในโปรเจกต์นี้ ไปวางแทนที่
4. กดปุ่ม **บันทึก (Save)** (รูปแผ่นดิสก์) ตั้งชื่อโปรเจกต์ว่า `AssessmentAPI`

## 3. การ Deploy เพื่อใช้งาน

1. คลิกปุ่ม **การทำให้ใช้งานได้ (Deploy)** (มุมขวาบน) > **การทำให้ใช้งานได้รายการใหม่ (New deployment)**
2. คลิกไอคอนฟันเฟือง (Select type) เลือก **เว็บแอป (Web app)**
3. ตั้งค่าดังนี้:
   - **คำอธิบาย (Description):** API for Student Assessment
   - **ดำเนินการในฐานะ (Execute as):** **ฉัน (Me)** (อีเมลของคุณ)
   - **ผู้ที่มีสิทธิ์เข้าถึง (Who has access):** **ทุกคน (Anyone)** <--- *สำคัญมาก ต้องเลือกอันนี้*
4. คลิก **การทำให้ใช้งานได้ (Deploy)**
5. ระบบจะขอสิทธิ์การเข้าถึง (Authorize access)
   - คลิก **ตรวจสอบสิทธิ์ (Review permissions)**
   - เลือกบัญชี Google ของคุณ
   - ถ้าขึ้นหน้าจอเตือนความปลอดภัย ให้คลิก **Advanced** > **Go to AssessmentAPI (unsafe)**
   - คลิก **Allow**
6. เมื่อเสร็จสิ้น คุณจะได้รับ **Web App URL** (ลิงก์ยาวๆ ที่ขึ้นต้นด้วย `https://script.google.com/macros/s/...`)
7. **คัดลอก URL นี้เก็บไว้**

## 4. การเชื่อมต่อกับ Frontend

1. เปิดไฟล์ `services/api.ts` ในโปรเจกต์นี้
2. นำ URL ที่ได้จากขั้นตอนที่ 3 มาวางในตัวแปร `GOOGLE_SCRIPT_URL`
   ```typescript
   // services/api.ts
   const GOOGLE_SCRIPT_URL = "วาง_URL_ของคุณที่นี่";
   ```

---

## การทำงานของระบบ

เมื่อติดตั้งเสร็จสมบูรณ์ ระบบจะทำงานดังนี้:

1. **แยกห้องอัตโนมัติ:** เมื่อมีการบันทึกข้อมูลนักเรียน ระบบจะตรวจสอบว่า "ระดับชั้น" (เช่น ป.4/A) มีชีต (Tab) อยู่แล้วหรือไม่
   - ถ้า **มี**: จะบันทึกข้อมูลลงในชีตนั้น
   - ถ้า **ไม่มี**: ระบบจะสร้างชีตใหม่ ชื่อ "ป.4-A" (เปลี่ยน / เป็น - อัตโนมัติ) และสร้างหัวตารางให้ทันที

2. **โครงสร้างตาราง:** หัวตารางจะถูกสร้างอัตโนมัติ ประกอบด้วย:
   - ID (รหัสอ้างอิง)
   - เลขที่
   - ชื่อ-นามสกุล
   - คะแนนรวม
   - ร้อยละ
   - ผลการประเมิน
   - จุดเด่น
   - จุดควรพัฒนา
   - ครูผู้ประเมิน
   - วันที่ประเมิน
   - RawData (ข้อมูลดิบสำหรับการแก้ไขฟอร์ม)

3. **การอัปเดตข้อมูล:** ถ้านักเรียนคนเดิมถูกประเมินซ้ำ ระบบจะค้นหาจาก ID และอัปเดตแถวเดิม ไม่สร้างแถวซ้ำ